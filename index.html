<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Color Sort</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" />
  <link rel="stylesheet" href="styles/reset.css" />
  <link rel="stylesheet" href="styles/main.css" />
</head>

<body>

  <div class="container">
    <div id="swatch-container" class="swatch-container"></div>

    <form id="input-form">
    <div class="control-container">
      <div>
        <div>
          <label for="primary-sort">Primary Sort</label>
          <select name="primary-sort" id="primary-sort">
            <option value="hue" selected>Hue</option>
            <option value="saturation">Saturation</option>
            <option value="lightness">Lightness</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="blue">Blue</option>
          </select>
        </div>

        <div>
          <label for="primary-asc" class="checkbox-label">Ascending?</label>
          <input type="checkbox" id="primary-asc" name="primary-asc">
        </div>

        <div>
          <label for="secondary-sort">Secondary Sort</label>
          <select name="secondary-sort" id="secondary-sort">
            <option value="hue">Hue</option>
            <option value="saturation" selected>Saturation</option>
            <option value="lightness">Lightness</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="blue">Blue</option>
          </select>
        </div>

        <div>
          <label for="secondary-asc" class="checkbox-label">Ascending?</label>
          <input type="checkbox" id="secondary-asc" name="secondary-asc">
        </div>

        <div>
          <label for="tertiary-sort">Tertiary Sort</label>
          <select name="tertiary-sort" id="tertiary-sort">
            <option value="hue">Hue</option>
            <option value="saturation">Saturation</option>
            <option value="lightness" selected>Lightness</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="blue">Blue</option>
          </select>
        </div>

        <div>
          <label for="tertiary-asc" class="checkbox-label">Ascending?</label>
          <input type="checkbox" id="tertiary-asc" name="tertiary-asc">
        </div>

        <div>
          <label for="format-option">Format to</label>
          <select name="format-option" id="format-option">
            <option value="hex6">Hexidecimal</option>
            <option value="prgb">Red-Green-Blue</option>
            <option value="hsl">Hue-Saturation-Lightness</option>
          </select>
        </div>

        <div>
          <label for="dedup" class="checkbox-label">Remove Duplicates</label>
          <input type="checkbox" id="dedup" name="dedup">
        </div>
      </div>
      <div>
        <label for="color-input">Add your hex, rga, and/or hsl colors here...</label>
        <textarea name="color-input" id="color-input" class="color-input"></textarea>
      </div>
      <div>
        <button id="sort-button" type="button">Sort</button>
      </div>
      <div>
        <button id="download-button" type="button">Sort &amp; Download JSON</button>
      </div>
    </div>
    </form>

  </div>
</body>

<script src="dist/colorsort.js"></script>
<script>
  let sortButton = document.getElementById('sort-button');
  let form = document.getElementById('input-form');
  let colors;

  sortButton.addEventListener('click', sort);

  function sort() {
    const input = form.elements['color-input'].value;
    const format = form.elements['format-option'].value;
    const swatchContainer = document.getElementById('swatch-container');

    const criteria = [
      { sort: form.elements['primary-sort'].value, asc: form.elements['primary-asc'].checked },
      { sort: form.elements['secondary-sort'].value, asc: form.elements['secondary-asc'].checked },
      { sort: form.elements['tertiary-sort'].value, asc: form.elements['tertiary-asc'].checked },
    ];

    colors = form.elements['dedup'].checked ?
      new ColorSort(input).set().sort(criteria) :
      new ColorSort(input).sort(criteria);

    form.elements['color-input'].value = colors
      .formattedValues(format)
      .join(', ')
      .toUpperCase();

    console.log(colors.collection.length);
    const boxSize = determineSwatchSize(colors.collection.length);
    const colorElements = colors.collection.map(elem => {
      return `<div class="swatch" style="background: ${elem.toHexString()}; width: ${boxSize[0]}%; height: ${boxSize[1]}vh" title="${elem.toString(format).toUpperCase()}"></div>`
    }).join('');

    swatchContainer.innerHTML = colorElements;
  }

  function determineSwatchSize(count) {
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;
    let size = windowWidth;
    let cubePerLine = 1;

    while (size * (count / cubePerLine) > windowHeight) {
      cubePerLine++;
      size = windowWidth / cubePerLine - 10;
    }

    return [
      100 / cubePerLine,
      100 / Math.ceil(count / cubePerLine)
    ];
  }
</script>

</html>
